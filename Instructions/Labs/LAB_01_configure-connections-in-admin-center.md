# 実習ラボ 1: Microsoft Graph コネクタの接続を構成する

## WWL テナント - 使用条件

講師が指導するトレーニング配信の一環としてテナントを提供されている場合は、講師が指導するトレーニングでハンズオンラボをサポートする目的でテナントを利用できることに注意してください。

テナントを共有したり、ハンズオン ラボ以外の目的で使用したりしないでください。 このコースで使われるテナントは試用版テナントであり、クラスが終了し、拡張機能の対象となっていない場合は、使用したりアクセスしたりすることはできません。

テナントを有料サブスクリプションに変換することはできません。 このコースの一環として取得したテナントは Microsoft Corporation の財産のままであり、当社はいつでもアクセス権とリポジトリを取得する権利を留保します。

## まとめ

このラボでは、Microsoft 365 管理センターの Microsoft ファイル共有コネクタを使用して、顧客ファイルへの接続を構築します。

あなたは、中規模の会社である Contoso のカスタマー サービス マネージャーとします。 お客様のチームは、顧客の問い合わせを処理する際の応答時間と全体的な効率に苦労してきました。 Microsoft 365 管理センターを利用して FileShare 接続を作成し、カスタマー サービス エージェントが顧客ファイルにすばやくアクセスして参照できるようにします。

## 演習 1: Microsoft 365 管理センターで接続を構成する

### VM にログインする

ラボ ホスティング プロバイダーは、既定のテナント管理者である MOD 管理者アカウントのパスワードを提供します。 セキュリティ上の理由から、Microsoft では、試用版テナントを構成して、すべての事前定義済みユーザーが次回のサインイン時にパスワードを変更する必要があるようにしました。 パスワード **Pa55w.rd** を使用して、ラボ ホスティング プロバイダーによって作成されたローカル**管理者**アカウントとして **LON-CL1** にログインしてください。

### タスク 1: Azure portal でアクセス許可を付与する

1. Azure portal **https://www.portal.azure.com** に移動し、管理者資格情報を使用してサインインします。 パスワードを保存せず、 **サインインしますか?** で **はい** を選択します。
2. **Microsoft Azure へようこそ**の画面で、**Cancel** を選択します。
1. 画面の左側にあるドロップダウン メニュー アイコンを選択して、ポータル メニューを表示します。 **Microsoft Entra ID -> 管理 -> アプリ登録**を選択します。
1. 上部メニュー バーから、**[新規登録]** を選択します。 **[アプリケーションの登録]** ページが表示されます。 このページで、アプリの名前を指定します。このアプリに**Contoso Fileshare** と名前を付けます。 サポートされているアカウントタイプのオプションは、デフォルトの **[この組織のディレクトリ内のアカウントのみ (UmaContoso のみ – シングルテナント)]** のままにしてください。 省略可能な **[リダイレクト URI]** を選択しないでください。
1. **登録** を選択します。 アプリケーションが作成され、アプリケーション ID が割り当てられます。 この情報は、次の手順で Graph コネクタ エージェント (GCA) を作成するときに使用します。 ただし、GCA を作成する前に、必要な設定を構成しましょう。

次の手順では、Azure Portal で Graph コネクタ エージェントのアクセス許可を付与します。

1. 左側のメニューから **[管理] > [API のアクセス許可]** オプションを選択します。
1. **[アクセス許可の追加] > [Microsoft Graph] > [アプリケーションのアクセス許可]** を選択し、次の API へのアクセス許可を許可します。

    - [ディレクトリ] > [Directory.Read.All]
    - [ExternalConnection] > [ExternalConnection.ReadWrite.OwnedBy]
    - [ExternalItem] > [ExternalItem.ReadWrite.All]
      
1. **[アクセス許可の追加]** ボタンを選択します。
1. **[Contoso に対して管理者の同意を与える]** を選択し、**[はい]** を選択して確認します。

**注:** この [Edge ブラウザー] タブを閉じないでください。次のタスクでは、Azure portal から情報をコピーして貼り付ける必要があります。

### タスク 2: GCA をインストールする

1. 新しい Microsoft Edge ブラウザー タブを開きます。Graph コネクタ エージェントをダウンロードするには、次の URL に移動します: **https://www.microsoft.com/en-us/download/details.aspx?id=104045** 。 **[ダウンロード]** ボタンを選択します。 
1. **GcaInstaller_3.1.1.0.msi** ファイルを開き、セットアップ ウィザードの指示に従います。 
2. 画面の下部にある **検索** バーに「**Graph コネクタ エージェント構成**」と入力し、表示されたメニューからアプリを選択します。
3. **[はい]** を選択して、アプリがデバイスに変更を加えることを許可します。
4. **MOD 管理** アカウントを使用して、GCA にサインインして登録します。 認証が完了したことを確認するメッセージが Edge ブラウザーに表示されます。 このウィンドウは閉じても構いません。
5. 画面の下部にあるアイコンを選択して、GCA アプリを開きます。
1. このエージェントの名前を **ContosoFiles** に設定します。
1. Azure portal の [Microsoft Edge] タブを選択し (**Contoso Fileshare - Microsoft Azure** を読み取る必要があります)、**[概要]** 画面に移動し、**アプリケーション (クライアント) ID** をコピーします。 GCA インストール アプリに貼り付けます。

次に、Azure portal でこのアプリのクライアント シークレットを設定する必要があります。

1. [Azure portal Edge] タブに戻り、**[証明書とシークレット]** に移動します。
1. **+ 新しいクライアント シークレット**を選択します。 **Contoso Files** を入力して、**説明**を追加します。 有効期限フィールドは、既定の 180 日に設定したままにできます。
2. **[追加]** を選択します。
3. サイレント シークレットの **[Value]** フィールドをコピーします。
1. Graph コネクタ エージェント アプリに戻り、GCA インストーラー アプリの **[アプリケーション パスワード (クライアント シークレット)** フィールドに値を貼り付けます。
1. **登録** を選択します。
1. 登録が完了したら、インストーラー アプリを閉じます。

### タスク 3: Github からリソース ファイルをダウンロードする

GCA を使用してコネクタを構成するには、システムに対してローカルなファイルが必要です。 

1. 新しい Edge ブラウザーを開き、アドレス バーに「 **https://github.com/MicrosoftLearning/MS-4014-Build-a-foundation-to-extend-Microsoft-365-Copilot/tree/master/ResourceFiles** 」と入力します。
2. フォルダー内の最初のファイル **Contoso Chai Tea market trends 2023.xls** を選択して開きます。
3. 画面の右上にある **[省略記号 (その他のファイル アクション)]** ボタンを選択し、**[ダウンロード]** を選択します。
4. 残りのファイルごとに手順 3 を繰り返します。
5. ダウンロードが完了したら、このウィンドウを閉じることができます。
6. エクスプローラーを使用し、C:\ ディレクトリに移動します。 **ResourceFiles** という名前の新しいフォルダーを作成します。
7. 新しいエクスプローラー ウィンドウを開き、 **ダウンロード** フォルダーに移動して、GitHub からダウンロードした Contoso ファイルにアクセスします。 これらのファイルを **C:\ResourceFiles** ディレクトリにコピーします。

これらのファイルは、Microsoft 管理センターで作成する接続のソース コンテンツとして使用します。

### タスク 4: Microsoft 管理センターを開きます。

1. Microsoft Edge ブラウザーの新しいタブを開きます。Microsoft Edgeブラウザーで、アドレスバーに次のURLを入力して**Microsoft 365 ホーム**ページにアクセスしてください: **https://portal.office.com**
1. サインインを求められた場合は、Microsoft 365 試用版テナントのラボ ホスティング プロバイダーによって提供される LON-CL1 **ユーザー名**と**パスワード**を入力します。 ユーザー名は、**<admin@xxxxxZZZZZZ.onmicrosoft.com>** の形式で、xxxxxZZZZZZ は、ラボ ホスティング プロバイダーによって割り当てられたテナント プレフィックスである必要があります。 
1. **[Microsoft 365 へようこそ]** ページが、Microsoft Edge ブラウザー内の **[ホーム|Microsoft 365]** タブ内に表示されます。このページは MOD 管理者の Microsoft 365 ホーム ページです。
1. ナビゲーション ウィンドウ内に表示されるアプリケーション アイコンの一覧の中で **[管理]** を選択します。これで、新しいブラウザー タブ内に **[Microsoft 365 管理センター]** が開きます。
1. **[... すべて表示]** を選択し、完全なナビゲーション メニューを表示します。 **[設定]** -> **[検索とインテリジェンス] を選択します。**
1. 表示された **[概要]** タブで、下にスクロールします。 **[コネクタ]** ボックスから **[最初の接続を追加する]** を選択します。

ここから、使用可能なデータ ソースの一覧が表示されます。 ファイル共有コネクタを使用して接続を構成しています。 このコネクタを使用すると、Microsoft 365 Copilot 検索で Copilot 検索内の顧客ファイルを参照でき、顧客サービス エージェントが回答を見つける際の応答時間が短縮され、より正確な応答が可能になります。

1. **[ファイル共有]** を選択して、**[次へ]** を選択します。
1. **[表示名]** を入力します。 表示名は、ユーザーに表示される一意の名前です。 フィールドに **Contoso Files** と入力します。
1. **フォルダーのパス**を入力します。 次のディレクトリにサンプル ファイルが作成されています。

   **C:\ResourceFiles**

このパスはファイルが格納されているディレクトリです。

1. 既定のオプションでない場合は、 **Graph コネクタ エージェント** フィールドで、前の手順 (ContosoFiles) で作成した GCA を選択します。
1. 認証の種類として **Windows** を選択し、次にWindows 認証の LON-CLI **ユーザー名** と **パスワード** を入力します。
1. Microsoft が、テナント内のサードパーティ データのインデックスを作成することを承認するチェックボックスを選択してください。
1. **［作成］** を選択します  成功画面が表示され、接続の同期が開始されます。**[コネクタの説明]** ボックスには、特定の種類のコンテンツ、組織内でその利用のメリットを得られる部門、またはワークフローの例を入力できます。 次に例を示します。

    **このコネクタには、オンプレミスのファイル共有サーバーに含まれる情報が含まれています。これには、顧客プロファイルや、サポートデスクが顧客の問い合わせに回答する際に役立つ可能性のある顧客の質問が含まれています。**
1. **完了** を選択します。 これで、接続が、Microsoft 365 管理センターの **[検索とインテリジェンス]** タブに表示され、検索結果で参照されたり、Microsoft 365 Copilot エージェントをビルドする際に参照されたりします。
